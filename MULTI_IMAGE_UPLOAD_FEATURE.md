# Функция множественной загрузки изображений для новостей

## Описание изменений

Реализована функция загрузки нескольких изображений одновременно в админ-панели раздела новостей с возможностью выбора главного изображения для отображения в карточке новости.

## Что было сделано

### 1. Создан новый компонент `MultiImageUpload.tsx`

**Путь:** `src/components/admin/MultiImageUpload.tsx`

**Функционал:**
- Загрузка нескольких изображений одновременно (до 10 файлов за раз)
- Валидация типа файлов (только изображения)
- Валидация размера файлов (максимум 10MB на файл)
- Предпросмотр загруженных изображений в виде галереи
- Выбор главного изображения (нажатием на звездочку)
- Удаление изображений
- Визуальная индикация главного изображения (зеленая рамка и заполненная звезда)
- Конвертация изображений в base64 формат для хранения в БД

**Основные возможности:**
- Множественный выбор файлов через input[type="file"][multiple]
- Drag & drop (через стандартный file input)
- Визуальная обратная связь при наведении
- Автоматическая валидация и уведомления об ошибках

### 2. Обновлен компонент `NewsForm.tsx`

**Путь:** `src/components/admin/NewsForm.tsx`

**Изменения:**
1. Импортирован новый компонент `MultiImageUpload`
2. Добавлено состояние `selectedImageIndex` для отслеживания выбранного главного изображения
3. Заменена секция загрузки изображений на новый компонент
4. Реализована автоматическая перестановка изображений: когда пользователь выбирает изображение звездочкой, оно автоматически перемещается на первую позицию в массиве
5. Сохранена возможность добавления изображений по URL (как дополнительная опция)
6. Секция "Точка фокуса" теперь работает с главным (первым) изображением

## Как использовать

### Для администратора:

1. **Войдите в админ-панель**: http://localhost:3000/admin/login
2. **Перейдите в раздел "Новости"**: http://localhost:3000/admin/news
3. **Создайте новую новость** или **отредактируйте существующую**

### Загрузка изображений:

#### Способ 1: Множественная загрузка файлов
1. Нажмите кнопку "Загрузить изображения"
2. Выберите несколько файлов одновременно (Ctrl+Click или Shift+Click в диалоге выбора файлов)
3. Изображения загрузятся и отобразятся в галерее

#### Способ 2: Добавление по URL
1. Прокрутите до раздела "Или добавить изображение по URL"
2. Введите URL изображения
3. Нажмите кнопку "+"

### Выбор главного изображения:

1. В галерее изображений наведите курсор на нужное изображение
2. Нажмите на звездочку в левом верхнем углу
3. Выбранное изображение автоматически переместится на первую позицию
4. Это изображение будет отображаться в карточке новости на сайте

### Настройка точки фокуса:

1. После выбора главного изображения настройте "Точку фокуса"
2. Выберите одну из предложенных опций:
   - **Верх** - для фото с лицами/головами в верхней части
   - **Верхняя часть** - ближе к верху
   - **По умолчанию** - оптимально для людей (center 30%)
   - **Центр** - когда объект в центре
   - **Нижняя часть** - ближе к низу
   - **Низ** - когда важная часть внизу
3. Превью покажет, как изображение будет выглядеть в карточке

### Удаление изображений:

1. Наведите курсор на изображение в галерее
2. Нажмите на красную кнопку "X" в правом верхнем углу

## Технические детали

### Структура данных

Изображения хранятся в массиве `formData.images[]`:
- Первое изображение `images[0]` - главное (отображается в карточке)
- Остальные изображения - дополнительные (могут отображаться в галерее на странице новости)

### Валидация

- **Тип файла:** только изображения (image/*)
- **Размер файла:** максимум 10MB на файл
- **Количество файлов:** максимум 10 изображений на одну новость

### Формат хранения

Изображения конвертируются в base64 строки и хранятся непосредственно в базе данных PostgreSQL в поле `images` (JSONB массив).

## Тестирование

### Что нужно проверить:

1. **Загрузка одного изображения** ✓
2. **Загрузка нескольких изображений одновременно** ✓
3. **Выбор главного изображения** ✓
4. **Удаление изображений** ✓
5. **Добавление изображений по URL** ✓
6. **Настройка точки фокуса** ✓
7. **Сохранение новости с изображениями** - требует тестирования
8. **Редактирование существующей новости** - требует тестирования
9. **Отображение изображений в карточке новости на сайте** - требует тестирования

### Проверка валидации:

1. Попробуйте загрузить не-изображение (например, .txt файл) - должно показать ошибку
2. Попробуйте загрузить файл больше 10MB - должно показать ошибку
3. Попробуйте загрузить больше 10 изображений - должно показать ошибку

## Возможные улучшения в будущем

1. Drag & drop интерфейс для загрузки файлов
2. Возможность изменения порядка изображений перетаскиванием
3. Редактирование изображений (обрезка, поворот)
4. Загрузка изображений на внешний сервер (например, Cloudinary, S3)
5. Ленивая загрузка изображений в галерее
6. Прогресс-бар загрузки для больших файлов

## Файлы, которые были изменены

1. ✅ `src/components/admin/MultiImageUpload.tsx` - новый файл
2. ✅ `src/components/admin/NewsForm.tsx` - обновлен
3. ✅ `MULTI_IMAGE_UPLOAD_FEATURE.md` - документация (этот файл)

## Совместимость

- ✅ Обратная совместимость с существующими новостями
- ✅ Работает с текущей структурой базы данных (не требует миграций)
- ✅ Сохранена возможность добавления изображений по URL
- ✅ Все существующие функции (точка фокуса, AI улучшение текста) работают как прежде

## Статус

✅ **Реализация завершена**
⏳ **Требуется тестирование пользователем**

---

**Дата:** 2026-02-04
**Автор:** AI Assistant (Claude)
