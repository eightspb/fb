# –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞

**–ß—Ç–æ –±—ã–ª–æ:** –ö—Ä–∏–ø—Ç–æ–º–∞–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∂–∞–ª CPU –Ω–∞ 100%, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª 2.4GB –ø–∞–º—è—Ç–∏
**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã —Å –Ω—É–ª—è, –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

## üõ°Ô∏è –¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞

### Docker Security
- ‚úÖ `/tmp` –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Å `noexec` (–Ω–µ–ª—å–∑—è –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–∞–π–ª—ã)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ capabilities –∫—Ä–æ–º–µ NET_BIND_SERVICE
- ‚úÖ –í–∫–ª—é—á—ë–Ω `no-new-privileges`
- ‚úÖ –†–∞–∑–º–µ—Ä `/tmp` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 100MB

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
```bash
ssh root@155.212.217.60 'bash -s' < scripts/security-check.sh
```

–ò–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
cd /opt/fb-net
bash scripts/security-check.sh
```

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ 2)
```bash
ssh root@155.212.217.60 "docker exec fb-net-app ps aux"
```
**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
PID   USER     TIME  COMMAND
  1 nextjs    0:02 node server.js
 16 nextjs    0:00 ps aux
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ CPU (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 10%)
```bash
ssh root@155.212.217.60 "top -bn1 | head -15"
```
**–ù–æ—Ä–º–∞–ª—å–Ω–æ:** %Cpu(s): 0-10% us, 95%+ id

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
ssh root@155.212.217.60 "cd /opt/fb-net && docker compose -f docker-compose.production.yml logs --tail=50 app"
```
**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** ECONNREFUSED –∫ —Å—Ç—Ä–∞–Ω–Ω—ã–º IP/–ø–æ—Ä—Ç–∞–º

## üö® –ü—Ä–∏–∑–Ω–∞–∫–∏ –∑–∞—Ä–∞–∂–µ–Ω–∏—è

–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å–ª–∏:
- CPU –ø–æ—Å—Ç–æ—è–Ω–Ω–æ > 80%
- –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –±–æ–ª—å—à–µ 3-4 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ï—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã —Å –∏–º–µ–Ω–∞–º–∏ –∏–∑ /tmp/
- –ò—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã (–Ω–µ 80, 443, 3000, 5432)
- –û—à–∏–±–∫–∏ ECONNREFUSED –∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º IP

## üîí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤—å—Ç–µ –≤ cron –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –û—Ç–∫—Ä—ã—Ç—å crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤):
0 */6 * * * /opt/fb-net/scripts/security-check.sh >> /var/log/security-check.log 2>&1
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Netdata, Prometheus –∏ —Ç.–¥.) —Å –∞–ª–µ—Ä—Ç–∞–º–∏ –Ω–∞:
- CPU > 80% –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
- –ü–∞–º—è—Ç—å > 90%
- –ù–æ–≤—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã

### 3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
cd /opt/fb-net
bun audit                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
bun update                   # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤
docker compose down
docker compose up -d --build # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
```

### 4. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –≤—Ö–æ–¥–æ–≤
```bash
ssh root@155.212.217.60 "last -20"
ssh root@155.212.217.60 "grep 'Accepted' /var/log/auth.log | tail -20"
```

## üìû –í —Å–ª—É—á–∞–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞—Ä–∞–∂–µ–Ω–∏—è

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
   ssh root@155.212.217.60 "cd /opt/fb-net && docker compose down"
   
   # –£–±–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
   ssh root@155.212.217.60 "pkill -9 -f '/tmp/'"
   ```

2. **–£–¥–∞–ª–∏—Ç—å –≤—Å—ë:**
   ```bash
   ssh root@155.212.217.60 "docker system prune -af --volumes"
   ```

3. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å:**
   ```bash
   ssh root@155.212.217.60 "cd /opt/fb-net && git pull && docker compose up -d --build"
   ```

4. **–ù–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –Ω–∞ RCE —É—è–∑–≤–∏–º–æ—Å—Ç–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ `bun audit`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ injection

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [SECURITY_INCIDENT.md](SECURITY_INCIDENT.md) - –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–µ
- [Docker Security Best Practices](https://docs.docker.com/engine/security/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
