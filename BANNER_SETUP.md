# Настройка информационного баннера

## Применение миграции базы данных

### Локальная база данных

```bash
# Через Docker
docker exec -i fb-net-postgres psql -U postgres -d postgres < migrations/007_add_site_banner.sql

# Или через npm script
npm run docker:psql
\i migrations/007_add_site_banner.sql
\q
```

### Удаленная база данных (через SSH туннель)

```bash
# Если туннель уже запущен (порт 54321)
psql -h localhost -p 54321 -U postgres -d postgres < migrations/007_add_site_banner.sql

# Или через SSH напрямую
ssh root@155.212.217.60 "docker exec fb-net-db psql -U postgres -d postgres" < migrations/007_add_site_banner.sql
```

## Проверка установки

После применения миграции проверьте, что таблица создана:

```sql
SELECT * FROM site_banner;
```

Должна быть одна запись с настройками по умолчанию.

## Использование

### Админ-панель

1. Откройте `/admin/banner`
2. Настройте параметры баннера:
   - Включите/выключите баннер
   - Введите текст сообщения
   - Выберите стиль (статичный или бегущая строка)
   - Настройте цвета фона и текста
   - Выберите размер и толщину шрифта
   - Разрешите/запретите закрытие пользователями
3. Нажмите "Сохранить настройки"

### Публичный сайт

Баннер автоматически появится в верхней части всех страниц сайта (кроме админ-панели), если он включен в настройках.

Пользователи могут закрыть баннер (если это разрешено), и он больше не будет показываться для этого конкретного сообщения (хранится в localStorage браузера).

## API Endpoints

### Публичный API

- `GET /api/banner` - получить активный баннер (кэшируется на 60 секунд)

### Admin API

- `GET /api/admin/banner` - получить настройки баннера (требует авторизации)
- `PUT /api/admin/banner` - обновить настройки баннера (требует авторизации + CSRF токен)

## Особенности реализации

### Без новых зависимостей

Система использует только уже установленные библиотеки:
- Framer Motion для анимаций
- Lucide React для иконок
- Существующие UI компоненты (Checkbox, Button, Card, etc.)
- Нативный `<input type="color">` для выбора цветов

### Режимы отображения

1. **Static (статичный)** - текст отображается по центру
2. **Marquee (бегущая строка)** - текст движется справа налево с бесконечной анимацией

### LocalStorage

Закрытые баннеры сохраняются в localStorage с ключом `dismissed-banner-{hash}`, где hash - это хеш от текста сообщения. При изменении сообщения баннер появится снова.

## Troubleshooting

### Баннер не появляется

1. Проверьте, что миграция применена: `SELECT * FROM site_banner;`
2. Проверьте, что баннер включен в админ-панели (`enabled = true`)
3. Проверьте localStorage браузера - возможно, баннер был закрыт
4. Откройте консоль браузера и проверьте наличие ошибок

### Ошибка "Таблица не найдена"

Примените миграцию `migrations/007_add_site_banner.sql` к базе данных.

### Изменения не сохраняются

1. Проверьте, что вы авторизованы в админ-панели
2. Проверьте консоль браузера на наличие CSRF ошибок
3. Убедитесь, что цвета указаны в правильном формате (#rrggbb)
