# Редизайн страниц конференций - Руководство

## Обзор изменений

Страницы конференций были полностью переработаны согласно референсу https://oldfanet.tilda.ws/sms3

### Основные изменения:

1. **Одноколоночный макет** вместо двухколоночного
2. **Карточки спикеров 4 в ряд** (адаптивно: 1 на mobile, 2 на tablet, 4 на desktop)
3. **Разделение на докладчиков и президиум**
4. **Структурированное расписание** с поддержкой множественных докладов одного спикера
5. **Секция видео** с предыдущих мероприятий
6. **Inline event details** вместо sidebar

## Новая структура данных

### 1. Спикеры (speakers)

```typescript
interface Speaker {
  id: string;
  name: string;
  photo: string;
  credentials: string;
  institution: string;      // НОВОЕ: организация/город
  is_presidium: boolean;    // НОВОЕ: флаг президиума
  order: number;            // НОВОЕ: порядок отображения
}
```

**Изменения:**
- ✅ Добавлено поле `institution` - организация и город спикера
- ✅ Добавлено поле `is_presidium` - флаг принадлежности к президиуму
- ✅ Добавлено поле `order` - порядок отображения
- ❌ Убраны поля `report_title` и `report_time` (перенесены в расписание)

### 2. Расписание (program)

**Старый формат (поддерживается):**
```json
["Регистрация участников", "Доклад 1", "Перерыв", ...]
```

**Новый формат (структурированный):**
```typescript
interface ProgramItem {
  id: string;
  time_start: string;       // "10:00"
  time_end: string;         // "10:30"
  speaker_id?: string;      // связь со спикером
  speaker_name?: string;    // имя спикера (если нет в списке)
  title: string;            // тема доклада
  description?: string;     // дополнительное описание
  type: 'talk' | 'break' | 'other';
  order: number;
}
```

**Важно:** Один спикер может иметь несколько докладов (несколько ProgramItem с одинаковым speaker_id)

### 3. Видео (videos)

```typescript
interface ConferenceVideo {
  id: string;
  title: string;
  video_url: string;        // путь к файлу на сервере
  duration?: string;        // "5:30"
  order: number;
}
```

Видео хранятся в `public/videos/conferences/`

## Новые компоненты

### 1. SpeakerCard
Компактная карточка спикера для отображения 4 в ряд:
- Круглое фото
- Имя
- Регалии
- Институт/город
- БЕЗ темы доклада

```tsx
import { SpeakerCard } from '@/components/SpeakerCard';

<SpeakerCard speaker={speaker} />
```

### 2. ConferenceSchedule
Структурированное расписание с поддержкой множественных докладов:
- Время начала/окончания
- Фото и имя спикера
- Тема доклада
- Описание
- Разные стили для типов событий (доклад/перерыв/другое)

```tsx
import { ConferenceSchedule } from '@/components/ConferenceSchedule';

<ConferenceSchedule 
  program={conference.program as ProgramItem[]} 
  speakers={conference.speakers || []} 
/>
```

### 3. ConferenceVideos
Секция с видео с предыдущих мероприятий:
- Grid 1/2/3 колонки (mobile/tablet/desktop)
- Использует существующий VideoPlayer компонент
- Lazy loading

```tsx
import { ConferenceVideos } from '@/components/ConferenceVideos';

<ConferenceVideos videos={conference.videos} />
```

## Структура страницы

Новый порядок секций:

1. **Hero** с Cover Image
2. **Приветствие** (Description)
3. **Докладчики** (4 карточки в ряд)
4. **Президиум** (4 карточки в ряд)
5. **Расписание** (структурированная таблица)
6. **Event Details** (inline: дата, место, CME, контакты)
7. **Countdown Timer** (если upcoming)
8. **Видео** с предыдущих мероприятий
9. **Дополнительная информация**
10. **Форма регистрации**

## Админ-панель

### Управление спикерами

В форме конференции для каждого спикера:
- ФИО *
- Организация, город
- Регалии, должность
- Фото
- ☑ Член президиума конференции

**Убраны поля:**
- ❌ Время доклада (теперь в расписании)
- ❌ Название доклада (теперь в расписании)

### Управление расписанием

Два режима:
1. **Простой список** (legacy, для обратной совместимости)
2. **Структурированное расписание** (новый формат)

Переключение между режимами кнопкой в заголовке секции.

**Структурированное расписание:**
- Время начала/окончания
- Выбор спикера из списка (dropdown)
- Или ввод имени спикера вручную
- Название доклада/события
- Описание (опционально)
- Тип: Доклад / Перерыв / Другое

### Управление видео

Для каждого видео:
- Название видео *
- Длительность (опционально, например "5:30")
- Путь к видео файлу или загрузка файла
- Кнопки для изменения порядка

Видео загружаются в `public/videos/conferences/`

## Обратная совместимость

✅ Старые конференции продолжат работать:
- Старый формат `program: string[]` поддерживается
- Спикеры со старыми полями `report_title`/`report_time` отображаются корректно
- Если `is_presidium` не указан, считается `false`
- Если `institution` пустой, не показывается
- Если `videos` отсутствует, секция не отображается

## Миграция существующих конференций

### Автоматическая миграция не требуется

Старые данные будут работать как есть. Для использования новых возможностей:

1. Откройте конференцию в админке
2. Для каждого спикера:
   - Добавьте `institution` (организация, город)
   - Отметьте `is_presidium` если нужно
3. Переключите расписание на структурированный формат
4. Перенесите темы докладов из спикеров в расписание
5. Добавьте видео если есть

### Пример миграции

**Было:**
```json
{
  "speakers": [{
    "name": "Иванов И.И.",
    "credentials": "Д.м.н., профессор",
    "report_title": "Новые методы диагностики",
    "report_time": "10:00 - 10:30"
  }],
  "program": [
    "Регистрация участников",
    "Доклад: Новые методы диагностики"
  ]
}
```

**Стало:**
```json
{
  "speakers": [{
    "name": "Иванов И.И.",
    "credentials": "Д.м.н., профессор",
    "institution": "МНИОИ им. П.А. Герцена, Москва",
    "is_presidium": false,
    "order": 1
  }],
  "program": [
    {
      "time_start": "09:00",
      "time_end": "10:00",
      "title": "Регистрация участников",
      "type": "other",
      "order": 1
    },
    {
      "time_start": "10:00",
      "time_end": "10:30",
      "speaker_id": "speaker-1",
      "title": "Новые методы диагностики",
      "type": "talk",
      "order": 2
    }
  ]
}
```

## Файлы изменений

### Новые файлы:
- `migrations/003_restructure_conferences.sql` - документация структуры БД
- `src/lib/types/conference.ts` - TypeScript интерфейсы
- `src/components/SpeakerCard.tsx` - карточка спикера
- `src/components/ConferenceSchedule.tsx` - расписание
- `src/components/ConferenceVideos.tsx` - секция видео
- `public/videos/conferences/` - папка для видео

### Измененные файлы:
- `src/app/conferences/[id]/page.tsx` - страница конференции (одноколоночный макет)
- `src/components/admin/ConferenceForm.tsx` - админ-форма (новые поля и секции)

## Тестирование

1. Создайте тестовую конференцию с новой структурой
2. Проверьте отображение на desktop/tablet/mobile
3. Проверьте работу админ-формы
4. Убедитесь что старые конференции отображаются корректно

## Поддержка

При возникновении вопросов обращайтесь к:
- Документации в `migrations/003_restructure_conferences.sql`
- Примерам в коде компонентов
- TypeScript интерфейсам в `src/lib/types/conference.ts`
