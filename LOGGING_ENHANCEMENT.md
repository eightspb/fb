# –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 9 —Ñ–µ–≤—Ä–∞–ª—è 2026

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

### üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 1. HTTP –∑–∞–ø—Ä–æ—Å—ã (middleware.ts)
- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
  - –ú–µ—Ç–æ–¥ (GET/POST/PUT/DELETE)
  - –ü—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞  
  - Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  - IP –∞–¥—Ä–µ—Å
  - User-Agent
- **–ò—Å–∫–ª—é—á–µ–Ω—ã:** —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã, _next, favicon

#### 2. –°–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (middleware.ts)
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- CSRF –Ω–∞—Ä—É—à–µ–Ω–∏—è  
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ rate limits
- –í—Å–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º `Security` –∏ `RateLimit`

#### 3. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (auth/route.ts)
- –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥: `‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å`
- –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞: `‚ùå –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º`

#### 4. –î–µ–π—Å—Ç–≤–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ (requests/[id]/route.ts + –¥—Ä—É–≥–∏–µ API)
- CREATE: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
- UPDATE: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
- DELETE: –£–¥–∞–ª–µ–Ω–∏–µ
- –ö–æ–Ω—Ç–µ–∫—Å—Ç: `UserAction`

#### 5. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (instrumentation.ts)
- –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
  - –í–µ—Ä—Å–∏—è Node.js
  - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
  - Environment (dev/production)
  - PID –ø—Ä–æ—Ü–µ—Å—Å–∞
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (SIGTERM/SIGINT)

### üì¶ –ù–æ–≤—ã–π –º–æ–¥—É–ª—å: user-actions-logger.ts

–£–ø—Ä–æ—â–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ API endpoints:

```typescript
// –ò–º–ø–æ—Ä—Ç
import {
  logDataAction,
  logUnauthorizedAttempt, 
  logApiError,
  logFormSubmission,
  logEmailSent,
  logDataExport
} from '@/lib/user-actions-logger';

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
logDataAction(request, 'create', 'news', newsId, { title: '–ù–æ–≤–æ—Å—Ç—å' });
logUnauthorizedAttempt(request, 'Invalid session');
logApiError(request, error, 'Create news API');
logFormSubmission(request, 'contact', true);
logEmailSent('user@example.com', 'Welcome', true);
logDataExport(request, 'csv', 100);
```

### üìä –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –ª–æ–≥–æ–≤

| –ö–æ–Ω—Ç–µ–∫—Å—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `HTTP` | HTTP –∑–∞–ø—Ä–æ—Å—ã |
| `Auth` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `UserAction` | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `Security` | –°–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ |
| `API` | –û—à–∏–±–∫–∏ API |
| `Form` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º |
| `Email` | Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `Export` | –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö |
| `System` | –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è |
| `RateLimit` | –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ |
| `Database` | –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏ |

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **middleware.ts** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. **instrumentation.ts** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç–∞/—Å—Ç–æ–ø–∞ —Å–µ—Ä–≤–µ—Ä–∞
3. **src/app/api/admin/auth/route.ts** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
4. **src/app/api/admin/requests/[id]/route.ts** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
5. **src/lib/user-actions-logger.ts** - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
6. **LOGGING.md** - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `/admin/logs` –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:

```
[HTTP] GET /api/news?limit=10
[Auth] ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
[UserAction] –°–æ–∑–¥–∞–Ω news #123
[UserAction] –û–±–Ω–æ–≤–ª—ë–Ω form_submission #45
[Security] –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: /admin/dashboard
[RateLimit] Rate limit exceeded –¥–ª—è 192.168.1.1
[System] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (Node v22.18.0, production)
[API] API Error: Database connection failed
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –í—Å–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞—Ç—á–∏–Ω–≥ (50 –∑–∞–ø–∏—Å–µ–π –∏–ª–∏ 2 —Å–µ–∫—É–Ω–¥—ã)
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Å–µ—Ö –≤–∞–∂–Ω—ã—Ö –ø–æ–ª—è—Ö (level, context, created_at, path)

## –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ –ù–ï –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- User-Agent –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤
- –¢–æ–∫–µ–Ω—ã –∏ —Å–µ–∫—Ä–µ—Ç—ã –ù–ï –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ª–æ–≥–∏
- –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤**: https://fibroadenoma.net/admin/logs
2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü–æ —É—Ä–æ–≤–Ω—é (info/warn/error) –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
3. **–≠–∫—Å–ø–æ—Ä—Ç**: –ö–Ω–æ–ø–∫–∞ "–≠–∫—Å–ø–æ—Ä—Ç" –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è JSON
4. **–û—á–∏—Å—Ç–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö API endpoints:

```typescript
// –í –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏
import { logDataAction, logUnauthorizedAttempt, logApiError } from '@/lib/user-actions-logger';

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
if (!isAuthenticated) {
  logUnauthorizedAttempt(request, 'Reason');
  return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
}

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
logDataAction(request, 'create', 'resource_type', resourceId, { additionalData });

// –í catch –±–ª–æ–∫–µ
catch (error) {
  logApiError(request, error, 'Context');
  return NextResponse.json({ error: error.message }, { status: 500 });
}
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–∏—Ç—å –≤:

- [ ] –í—Å–µ API endpoints (news, conferences, etc.)
- [ ] –§–æ—Ä–º—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ (contact form, consultation request)
- [ ] Email –æ—Ç–ø—Ä–∞–≤–∫—É
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- [ ] Telegram –±–æ—Ç–∞
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫—É

## –ú–∏–≥—Ä–∞—Ü–∏—è

–¢–∞–±–ª–∏—Ü–∞ `app_logs` —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞ –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö.
