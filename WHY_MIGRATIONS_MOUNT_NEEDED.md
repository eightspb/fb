# –ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –º–æ–Ω—Ç–∞–∂ –ø–∞–ø–∫–∏ migrations?

## ü§î –í–æ–ø—Ä–æ—Å

–ö–∞–∫ —Ä–∞–Ω—å—à–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ –º–æ–Ω—Ç–∞–∂–∞ –ø–∞–ø–∫–∏ `migrations` –≤ docker-compose —Ñ–∞–π–ª–∞—Ö?

## üìù –û—Ç–≤–µ—Ç: –ù–ï —Ä–∞–±–æ—Ç–∞–ª–∏!

### –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∫—Ä–∏–ø—Ç–µ –¥–µ–ø–ª–æ—è

–°–∫—Ä–∏–ø—Ç `deploy-from-github.ps1` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `Invoke-Migrations` (—Å—Ç—Ä–æ–∫–∞ 340):

```powershell
& $SshPath $Server "cd $RemotePath && docker compose -f $ComposeFile exec -T postgres psql -U postgres -d postgres -v ON_ERROR_STOP=1 -f $migrationPath"
```

–ì–¥–µ `$migrationPath` = `migrations/004_add_videos_to_conferences.sql`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

1. –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**
2. Docker Compose –∑–∞–ø—É—Å–∫–∞–µ—Ç `psql` **–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
3. `psql` –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –ø–æ –ø—É—Ç–∏ `migrations/004_add_videos_to_conferences.sql`
4. –ù–æ —ç—Ç–æ—Ç –ø—É—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ **—Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**, –∞ –Ω–µ —Ö–æ—Å—Ç–∞!
5. **–ë–ï–ó –º–æ–Ω—Ç–∞–∂–∞** –ø–∞–ø–∫–∏ `migrations` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –≤–∏–¥–∏—Ç —ç—Ç–∏ —Ñ–∞–π–ª—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç

```bash
psql: migrations/004_add_videos_to_conferences.sql: No such file or directory
```

## üîç –ü–æ—á–µ–º—É —Ä–∞–Ω—å—à–µ –∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
migrations/
‚îú‚îÄ‚îÄ 001_add_request_fields.sql       # –†–µ–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ 003_restructure_conferences.sql  # –¢–û–õ–¨–ö–û –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø!
```

–ú–∏–≥—Ä–∞—Ü–∏—è `003_restructure_conferences.sql` —Å–æ–¥–µ—Ä–∂–∏—Ç **—Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**:

```sql
-- Migration 003: Restructure conferences for new design
-- This migration documents the new JSONB structure for conferences table
-- No actual schema changes needed - only JSONB field structure changes
```

–û–Ω–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç SQL –∫–æ–º–∞–Ω–¥, –ø–æ—ç—Ç–æ–º—É:
- –ï—Å–ª–∏ –æ–Ω–∞ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å - –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ
- –ï—Å–ª–∏ –æ–Ω–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å - —Ç–æ–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ
- –û—à–∏–±–æ–∫ –Ω–µ –±—ã–ª–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ–∞–π–ª –±—ã–ª –ø—É—Å—Ç—ã–º (—Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É migrations (–¢–ï–ö–£–©–ò–ô –ü–û–î–•–û–î)

–í `docker-compose.yml`, `docker-compose.production.yml` –∏ `docker-compose.ssl.yml`:

```yaml
services:
  postgres:
    volumes:
      - postgres-prod-data:/var/lib/postgresql/data
      - ./database-schema.sql:/docker-entrypoint-initdb.d/00-init-schema.sql:ro
      # –ú–æ–Ω—Ç–∞–∂ –ø–∞–ø–∫–∏ migrations
      - ./migrations:/migrations:ro
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `psql -f /migrations/xxx.sql`
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞: `docker compose exec postgres psql -f /migrations/004_add_videos_to_conferences.sql`

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ docker-compose —Ñ–∞–π–ª—ã

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê)

–ò–∑–º–µ–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è, —á—Ç–æ–±—ã –æ–Ω –∫–æ–ø–∏—Ä–æ–≤–∞–ª —Ñ–∞–π–ª—ã:

```powershell
# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker cp $migrationPath $containerName:/tmp/migration.sql

# –ü—Ä–∏–º–µ–Ω—è–µ–º
docker exec $containerName psql -U postgres -d postgres -f /tmp/migration.sql

# –£–¥–∞–ª—è–µ–º
docker exec $containerName rm /tmp/migration.sql
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º docker-compose

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
- ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã

## üéØ –ù–∞—à –≤—ã–±–æ—Ä: –í–∞—Ä–∏–∞–Ω—Ç 1

–ú—ã –≤—ã–±—Ä–∞–ª–∏ **–º–æ–Ω—Ç–∞–∂ –ø–∞–ø–∫–∏ migrations**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. **–ü—Ä–æ—â–µ** - –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
2. **–ù–∞–¥—ë–∂–Ω–µ–µ** - —Ñ–∞–π–ª—ã –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
3. **–£–¥–æ–±–Ω–µ–µ** - –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ** - —Ç–∞–∫ –¥–µ–ª–∞—é—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø—Ä–æ–µ–∫—Ç–æ–≤

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –ê—Å–ø–µ–∫—Ç | –° –º–æ–Ω—Ç–∞–∂–æ–º | –ë–µ–∑ –º–æ–Ω—Ç–∞–∂–∞ (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ) |
|--------|------------|---------------------------|
| –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ docker-compose | ‚úÖ –î–∞ (3 —Ñ–∞–π–ª–∞) | ‚ùå –ù–µ—Ç |
| –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∫—Ä–∏–ø—Ç–µ –¥–µ–ø–ª–æ—è | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π | ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ–µ |
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å | ‚úÖ –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è |

## ‚úÖ –ò—Ç–æ–≥

**–ú–æ–Ω—Ç–∞–∂ –ø–∞–ø–∫–∏ `migrations` –Ω–µ–æ–±—Ö–æ–¥–∏–º** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è.

–ë–µ–∑ –º–æ–Ω—Ç–∞–∂–∞:
- ‚ùå –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚ùå –ü–æ–ª—É—á–∏–º –æ—à–∏–±–∫—É "No such file or directory"
- ‚ùå –ù—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `docker cp`

–° –º–æ–Ω—Ç–∞–∂–æ–º:
- ‚úÖ –°–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π

## üöÄ –ß—Ç–æ –¥–µ–ª–∞—Ç—å

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç—Ä–∏ docker-compose —Ñ–∞–π–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
2. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π
4. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

```powershell
.\scripts\commit-and-push.ps1 -Message "Fix: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ –¥–ª—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–π"
.\scripts\deploy-from-github.ps1
```
