# GitHub Actions - –ê—É–¥–∏—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### Workflow —Ñ–∞–π–ª—ã

–£ –≤–∞—Å –µ—Å—Ç—å 2 workflow —Ñ–∞–π–ª–∞:

1. **`.github/workflows/ci.yml`** - CI Pipeline
   - –¢—Ä–∏–≥–≥–µ—Ä—ã: push –≤ `main`/`develop`, pull requests
   - –î–∂–æ–±—ã: lint, type-check, unit tests, build, docker build, e2e tests, security scan
   
2. **`.github/workflows/deploy.yml`** - Deploy to Production
   - –¢—Ä–∏–≥–≥–µ—Ä—ã: push –≤ `master`/`main`, manual dispatch
   - –î–∂–æ–±—ã: build-and-push, deploy, rollback

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤–µ—Ç–æ–∫

**CI Pipeline** (`ci.yml`) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –≤–µ—Ç–∫–∏: `main`, `develop`  
**Deploy** (`deploy.yml`) –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –≤–µ—Ç–∫–∏: `master`, `main`  
**–í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –≤–µ—Ç–∫–∞:** `master`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** CI Pipeline –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ `master`!

## üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ GitHub Secrets

–î–ª—è —Ä–∞–±–æ—Ç—ã –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:

1. **`SSH_PRIVATE_KEY`** - SSH –∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VPS
2. **`VPS_HOST`** - IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω VPS (–Ω–∞–ø—Ä–∏–º–µ—Ä: `155.212.217.60` –∏–ª–∏ `fibroadenoma.net`)
3. **`VPS_USER`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SSH (–æ–±—ã—á–Ω–æ `root`)
4. **`VPS_PROJECT_PATH`** - –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `/opt/fb-net`)
5. **`TELEGRAM_BOT_TOKEN`** - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
6. **`TELEGRAM_ADMIN_CHAT_ID`** - ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤:

–û—Ç–∫—Ä–æ–π—Ç–µ: https://github.com/eightspb/fb/settings/secrets/actions

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫–∏ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–û–±–Ω–æ–≤–∏—Ç–µ `ci.yml` —á—Ç–æ–±—ã –æ–Ω —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–ª —Å –≤–µ—Ç–∫–æ–π `master`:

```yaml
on:
  push:
    branches: [main, master, develop]  # –î–æ–±–∞–≤–∏—Ç—å master
  pull_request:
    branches: [main, master, develop]  # –î–æ–±–∞–≤–∏—Ç—å master
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É master ‚Üí main

```bash
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ç–∫—É
git branch -m master main

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É –∏ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é
git push origin main
git push origin --delete master

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å upstream
git push --set-upstream origin main
```

–ó–∞—Ç–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö GitHub –∏–∑–º–µ–Ω–∏—Ç—å default branch –Ω–∞ `main`.

## üìã –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Actions –≤–∫–ª—é—á–µ–Ω—ã

- [ ] –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/eightspb/fb/settings/actions
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Actions –≤–∫–ª—é—á–µ–Ω—ã
- [ ] –í—ã–±–µ—Ä–∏—Ç–µ "Allow all actions and reusable workflows"

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã

- [ ] –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/eightspb/fb/settings/secrets/actions
- [ ] –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (—Å–ø–∏—Å–æ–∫ –≤—ã—à–µ)

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

- [ ] –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/eightspb/fb/settings/actions
- [ ] –í —Ä–∞–∑–¥–µ–ª–µ "Workflow permissions" –≤—ã–±–µ—Ä–∏—Ç–µ:
  - ‚úÖ "Read and write permissions"
  - ‚úÖ "Allow GitHub Actions to create and approve pull requests"

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Container Registry

- [ ] –û—Ç–∫—Ä–æ–π—Ç–µ https://github.com/eightspb/fb/settings
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GitHub Container Registry (ghcr.io) –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–∫–µ—Ç—ã: https://github.com/eightspb?tab=packages

### 5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤–µ—Ç–æ–∫

–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—ã—à–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ.

### 6. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç
git commit --allow-empty -m "test: trigger GitHub Actions"
git push origin master
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: https://github.com/eightspb/fb/actions

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

1. **Actions**: https://github.com/eightspb/fb/actions
2. **–ü–æ—Å–ª–µ–¥–Ω–∏–π workflow**: https://github.com/eightspb/fb/actions/runs
3. **–°–µ–∫—Ä–µ—Ç—ã**: https://github.com/eightspb/fb/settings/secrets/actions
4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Actions**: https://github.com/eightspb/fb/settings/actions

### –ß–µ—Ä–µ–∑ PowerShell (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω gh CLI):

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å GitHub CLI
winget install GitHub.cli

# –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
gh auth login

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ workflow
gh run list --limit 5

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
gh run view --log
```

## üö® –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. CI Pipeline –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è master

**–ü—Ä–æ–±–ª–µ–º–∞:** `ci.yml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `main`/`develop`, –∞ –≤—ã –ø—É—à–∏—Ç–µ –≤ `master`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `master` –≤ —Ç—Ä–∏–≥–≥–µ—Ä—ã `ci.yml` (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç 1 –≤—ã—à–µ)

### 2. Deploy –º–æ–∂–µ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, –¥–µ–ø–ª–æ–π —É–ø–∞–¥–µ—Ç –Ω–∞ —ç—Ç–∞–ø–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã (—Å–º. —á–µ–∫-–ª–∏—Å—Ç –≤—ã—à–µ)

### 3. Docker Scout –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –Ω–∞–π–¥–µ–Ω—ã, workflow —É–ø–∞–¥–µ—Ç (`exit-code: true`)

**–†–µ—à–µ–Ω–∏–µ:** –õ–∏–±–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –ª–∏–±–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `exit-code: false`

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–í `deploy.yml` –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–æ–±–∞–≤–∏—Ç—å:

```yaml
# Apply database migrations
echo "üìä Applying database migrations..."
docker exec fb-net-db psql -U postgres -d postgres -f /opt/fb-net/migrations/007_add_site_banner.sql || echo "Migration already applied"
```

### 2. –î–æ–±–∞–≤–∏—Ç—å health check endpoint

–°–æ–∑–¥–∞—Ç—å `/api/health` endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### 3. –£–ª—É—á—à–∏—Ç—å rollback

–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ health check.

### 4. –î–æ–±–∞–≤–∏—Ç—å Slack/Discord —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ö—Ä–æ–º–µ Telegram, –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –¥—Ä—É–≥–∏–µ –∫–∞–Ω–∞–ª—ã.

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å Actions:

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤–µ—Ç–∫–∏ –≤ ci.yml:**
   ```bash
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .github/workflows/ci.yml
   # –ó–∞–º–µ–Ω–∏—Ç—å branches: [main, develop] –Ω–∞ branches: [main, master, develop]
   ```

2. **–ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å:**
   ```bash
   git add .github/workflows/ci.yml
   git commit -m "fix: add master branch to CI triggers"
   git push origin master
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã** —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫** –Ω–∞ https://github.com/eightspb/fb/actions

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ Actions –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Actions –≤–∫–ª—é—á–µ–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (Workflow permissions)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ Actions
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –ø–∞–¥–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPS
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ VPS
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `docker-compose.production.yml` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–µ–ø–ª–æ—è –≤ Actions
