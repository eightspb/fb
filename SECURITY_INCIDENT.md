# Отчёт об инциденте безопасности

**Дата:** 04.02.2026
**Статус:** КРИТИЧЕСКИЙ - УСТРАНЁН

## Обнаруженные проблемы

### 1. Криптомайнер в Docker контейнере
- **Процессы:** `hskrxvrl3zG8`, `/tmp/nextjs`, `/tmp/sheovuceplca`
- **CPU:** 93-123% загрузка
- **Память:** 2.4GB использования
- **Пользователь:** nextjs (uid 1001) внутри Docker контейнера

### 2. Вредоносные файлы
Обнаружены поддельные системные файлы в `/tmp/`:
- `/tmp/.agetty/`, `/tmp/.irqbalance/`, `/tmp/.mysqld/`
- `/tmp/.systemd-*`, `/tmp/.postgres/`, `/tmp/.node_exporter/`

### 3. Ошибки подключения
Повторяющиеся попытки подключения к `193.142.147.209:12323` (майнинг пул)

## Предпринятые действия

1. ✅ Убиты все вредоносные процессы
2. ✅ Удалены контейнеры и образы
3. ✅ Очищена Docker система (8.7GB)
4. ✅ Проверены SSH логи - входы легитимные
5. ✅ Проверена конфигурация безопасности

## Возможные точки входа

1. **RCE уязвимость в приложении** (наиболее вероятно)
2. Уязвимые npm зависимости
3. Загрузка файлов без проверки
4. SQL injection с выполнением команд

## Рекомендации по безопасности

### Немедленно (КРИТИЧНО)
- [ ] Пересканировать все npm зависимости
- [ ] Проверить код на уязвимости
- [ ] Ограничить права пользователя в контейнере
- [ ] Добавить read-only файловую систему где возможно
- [ ] Отключить /tmp в контейнере или сделать noexec

### Краткосрочно
- [ ] Настроить мониторинг CPU/памяти с алертами
- [ ] Добавить Web Application Firewall (WAF)
- [ ] Регулярные сканирования на вредоносное ПО
- [ ] Логирование всех системных вызовов в контейнере

### Долгосрочно
- [ ] Переход на rootless Docker
- [ ] Использование AppArmor/SELinux профилей
- [ ] Регулярные аудиты безопасности
- [ ] Автоматические обновления зависимостей

## Проверка зависимостей

```bash
# Сканирование уязвимостей
bun audit

# Обновление зависимостей
bun update

# Проверка устаревших пакетов
bun outdated
```

## Мониторинг

Добавить алерты на:
- CPU > 80% более 5 минут
- Процессы в /tmp/
- Исходящие соединения на нестандартные порты
- Изменения в контейнере после запуска
